# R for Spatial Data: Futureproof foundations

- 6 October 2017

This document provides a how for the course on 2017-10-06 in LIDA Leeds.

It is primarily intended to provide a set of links for course participants but can also host code examples and notes from the workshop.


## Course feedback

Please fill-in this form to help us improve the course:
 https://leeds.onlinesurveys.ac.uk/rspatial2017 

## Slides

- See the 'slides' folder in for the text: [github.com/Robinlovelace/geocompr](https://github.com/Robinlovelace/geocompr/blob/master/slides/)
- For compiled slides on Spatial Data and the Tidyverse see [robinlovelace.net/presentations/spatial-tidyverse.html](http://robinlovelace.net/presentations/spatial-tidyverse.html#1)

## Links

- Agenda  and other course details on GitHub at [course-info/intro-info.Rmd](https://github.com/Robinlovelace/Creating-maps-in-R/blob/master/course-info/intro-info.Rmd)
- [Geocomputation with R](http://robinlovelace.net/geocompr/)

- An introduction to geographic data in R
    - Chapter 2 of [Geocomputation with R](http://robinlovelace.net/geocompr/spatial-class.html)
- Geographic data I/O
    - Chapter 5 of [Geocomputation with R](http://robinlovelace.net/geocompr/read-write.html)
- Introduction to visualising spatial data with R
    - [Creating-maps-in-R](https://github.com/Robinlovelace/Creating-maps-in-R) GitHub tutorial
- Point pattern analysis and rasterization
    - [Point Pattern analysis and spatial interpolation with R
](https://github.com/Robinlovelace/Creating-maps-in-R/blob/master/vignettes/point-pattern.md) from the previous tutorial

## Demos

```{r}
1:9
x = 1:9
y = x^2
plot(x, y)
library(spData)
library(sf)
library(tidyverse)

world
data(world)
world_df = as_data_frame(world)
```

Edit a file from the command line:

```{r, eval=FALSE}
file.edit("course-info/course-info.Rmd")
```

sp to sf translation

```{r}
library(sp)
g = SpatialGrid(GridTopology(c(0, 0), c(1, 1), c(3, 3)))
p = as(g, "SpatialPolygons")
library(sf)
p_sf = st_as_sf(p)
```

An intro to raster

```{r}
library(spDataLarge)
library(raster)
raster_filepath = system.file("raster/srtm.tif", package = "spDataLarge")
new_raster = raster(raster_filepath)
new_raster
class(new_raster)
plot(new_raster)
mapview::mapview(new_raster)
extent(new_raster)
library(spData)
st_bbox(world)
```



```{r}
library(sf)
library(raster)
library(tidyverse)
library(spData)
world_unite = world %>%
  tidyr::unite("con_reg", continent:region_un, sep = ":", remove = TRUE)

dplyr::select(world, continent)
```







 
## Advanced topological relations
 
 Selecting 'rook' and 'queen' relations
Source: 

```{r}
library(sp)
g = SpatialGrid(GridTopology(c(0, 0), c(1, 1), c(3, 3)))
p = as(g, "SpatialPolygons")
library(sf)
library(tidyverse)
p_sf = st_as_sf(p)
st_rook = function(a, b = a) st_relate(a, b, pattern = "F***1****")
st_queen <- function(a, b = a) st_relate(a, b, pattern = "F***T****")
p_queen = p_sf %>%
  mutate(NB_ROOK = st_queen(., b = p_sf[5,])) %>%
  filter(NB_ROOK == 1)
nrow(p_queen)
p_rook = p_sf %>%
  mutate(NB_ROOK = st_rook(., b = p_sf[5,])) %>% 
  filter(NB_ROOK == 1)
nrow(p_rook)
p_minDim2 = p_sf %>%
  filter(st_within(., y = p_sf[5,], sparse = FALSE)) 
nrow(p_minDim2)
```